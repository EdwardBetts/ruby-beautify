#!/usr/bin/env ruby
require 'ruby-beautify'
require 'ripper'
require 'optparse'

include RubyBeautify

Options = OptionParser.new do |opts|
	opts.on("-V", "--version", "Print version") { |version| puts RBeautify::VERSION;exit 0}
	opts.on("-c", "--indent_count [COUNT]", Integer, "Count of characters to use for indenting. (default: 1)") { |count| @indent_count = count}
	opts.on("-t", "--tabs", "Use tabs for the indent character (default)") { @indent_token = "\t" }
	opts.on("-s", "--spaces", "Use spaces for the indent character") { @indent_token = " " }
	opts.banner = "Usage: print ruby into a pretty format, or break trying."
end
Options.parse!

@indent_token = "\t" unless @indent_token
@indent_count = 1 unless @indent_count

# no argument, assume we want to open STDIN.
if ARGV.empty?
	content = $stdin.read
else
	file = ARGV[0]

	if File.exist? file
		content = open(file).read
	else
		puts "No such file: #{file}"
		exit
	end
end

if content
	if syntax_ok? content
		pretty content
	else
		puts content
		exit 127
	end
end
